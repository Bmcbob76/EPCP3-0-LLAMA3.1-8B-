<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECHO PRIME - Projects</title>
    <link rel="stylesheet" href="css/claude-official.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Official Claude Layout Structure -->
    <div class="claude-container">
        <!-- Left Sidebar -->
        <aside class="claude-sidebar">
            <div class="sidebar-header">
                <div class="claude-brand">
                    <i class="fas fa-crown claude-icon"></i>
                    <span class="brand-text">ECHO PRIME</span>
                </div>
            </div>

            <!-- New Chat Button -->
            <button class="new-chat-button">
                <i class="fas fa-plus"></i>
                <span>New chat</span>
            </button>

            <!-- Navigation Menu -->
            <nav class="sidebar-nav">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-message"></i>
                    <span>Chats</span>
                </a>

                <a href="projects.html" class="nav-link active">
                    <i class="fas fa-folder"></i>
                    <span>Projects</span>
                </a>

                <a href="#" class="nav-link">
                    <i class="fas fa-box"></i>
                    <span>Artifacts</span>
                </a>
            </nav>

            <!-- Sovereign Model Section -->
            <div class="sidebar-section collapsible">
                <div class="section-header" data-section="sovereign-model">
                    <div class="section-label">
                        <i class="fas fa-crown section-icon"></i>
                        <span>Sovereign Model</span>
                    </div>
                    <i class="fas fa-chevron-down dropdown-arrow"></i>
                </div>
                <div class="section-content" id="sovereign-model-content">
                    <div class="model-selector-section">
                        <select class="sidebar-model-selector" id="globalModelSelector">
                            <option value="sonnet-4.5">Echo Prime Sonnet 4.5</option>
                            <option value="gpt-4">GPT-4 Turbo</option>
                            <option value="claude-3">Echo Prime 3 Opus</option>
                            <option value="copilot">GitHub Copilot</option>
                            <option value="gemini">Google Gemini Pro</option>
                            <option value="groq">Groq Llama</option>
                            <option value="mistral">Mistral Large</option>
                            <option value="cohere">Cohere Command</option>
                            <option value="perplexity">Perplexity AI</option>
                            <option value="openrouter">OpenRouter</option>
                            <option value="ollama">Ollama Local</option>
                        </select>
                        <div class="model-status">
                            <div class="status-indicator active"></div>
                            <span class="status-text">Active</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Projects List -->
            <div class="sidebar-section collapsible">
                <div class="section-header" data-section="starred">
                    <div class="section-label">
                        <i class="fas fa-star section-icon"></i>
                        <span>Starred</span>
                    </div>
                    <i class="fas fa-chevron-down dropdown-arrow"></i>
                </div>
                <div class="section-content" id="starred-content">
                    <div class="project-item" data-project-id="gs-343-rebuild">
                        <i class="fas fa-folder"></i>
                        <span>GS 343 MODULAR REBUILD</span>
                    </div>
                    <div class="project-item" data-project-id="echo-prime-notebook">
                        <i class="fas fa-folder"></i>
                        <span>ECHO PRIME NOTEBOOK v...</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-section collapsible">
                <div class="section-header" data-section="untitled">
                    <div class="section-label">
                        <i class="fas fa-folder section-icon"></i>
                        <span>Untitled</span>
                    </div>
                    <i class="fas fa-chevron-down dropdown-arrow"></i>
                </div>
                <div class="section-content" id="untitled-content">
                    <div class="project-item" data-project-id="gs-343-guardian">
                        <i class="fas fa-folder"></i>
                        <span>GS 343 DIVINE GUARDIAN SUITE</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-section collapsible">
                <div class="section-header" data-section="recents">
                    <div class="section-label">
                        <i class="fas fa-clock section-icon"></i>
                        <span>Recents</span>
                    </div>
                    <i class="fas fa-chevron-down dropdown-arrow"></i>
                </div>
                <div class="section-content" id="recents-content">
                    <div class="project-item" data-project-id="claude-reverse">
                        <i class="fas fa-message"></i>
                        <span>Echo Prime app reverse engineering ...</span>
                    </div>
                    <div class="project-item" data-project-id="claude-integration">
                        <i class="fas fa-message"></i>
                        <span>Echo Prime code integration guide</span>
                    </div>
                    <div class="project-item" data-project-id="vs-auth">
                        <i class="fas fa-message"></i>
                        <span>VS system authorization</span>
                    </div>
                    <div class="project-item" data-project-id="vs-install">
                        <i class="fas fa-message"></i>
                        <span>VS Code extension installation tr...</span>
                    </div>
                    <div class="project-item" data-project-id="vs-troubleshoot">
                        <i class="fas fa-message"></i>
                        <span>VS Code extension troubleshoot ...</span>
                    </div>
                </div>
            </div>

            <!-- AI Services Section -->
            <div class="sidebar-section collapsible">
                <div class="section-header" data-section="ai-services">
                    <div class="section-label">
                        <i class="fas fa-robot section-icon"></i>
                        <span>AI Services</span>
                    </div>
                    <i class="fas fa-chevron-down dropdown-arrow"></i>
                </div>
                <div class="section-content" id="ai-services-content">
                    <div class="service-item" data-service="claude">
                        <div class="service-indicator active"></div>
                        <span>Echo Prime AI</span>
                    </div>
                    <div class="service-item" data-service="openai">
                        <div class="service-indicator active"></div>
                        <span>OpenAI GPT</span>
                    </div>
                    <div class="service-item" data-service="copilot">
                        <div class="service-indicator active"></div>
                        <span>GitHub Copilot</span>
                    </div>
                    <div class="service-item" data-service="gemini">
                        <div class="service-indicator inactive"></div>
                        <span>Google Gemini</span>
                    </div>
                </div>
            </div>

            <!-- User Profile -->
            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar">BM</div>
                    <div class="user-info">
                        <div class="user-name">bob mcwilliams</div>
                        <div class="user-plan">Max plan</div>
                    </div>
                    <button class="profile-menu-btn">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Projects Grid View -->
            <div class="projects-view" id="projectsGrid">
                <header class="projects-header">
                    <div class="header-left">
                        <h1>All projects</h1>
                        <button class="header-menu-btn">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                    </div>
                    <div class="header-right">
                        <button class="create-project-btn" id="createProjectBtn">
                            <i class="fas fa-plus"></i>
                            Create personal project
                        </button>
                        <button class="import-projects-btn" id="importProjectsBtn">
                            <i class="fas fa-file-import"></i>
                            Import Echo Prime Projects
                        </button>
                    </div>
                </header>

                <div class="projects-grid">
                    <!-- Example Project Cards -->
                    <div class="project-card" data-project-id="echo-prime">
                        <div class="project-header">
                            <h3>ECHO PRIME DESKTOP</h3>
                            <button class="project-menu">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                        </div>
                        <p class="project-description">Advanced server orchestration system with autonomous deployment
                            capabilities, health monitoring, and intelligent resource management for multi-platform
                            environments.</p>
                        <div class="project-footer">
                            <span class="project-updated">Updated 2 hours ago</span>
                            <button class="project-star">
                                <i class="fas fa-star"></i>
                            </button>
                        </div>
                    </div>

                    <div class="project-card" data-project-id="desktop-design">
                        <div class="project-header">
                            <h3>desktop design</h3>
                            <button class="project-menu">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                        </div>
                        <p class="project-description">instructions</p>
                        <div class="project-footer">
                            <span class="project-updated">Created today</span>
                            <button class="project-star">
                                <i class="far fa-star"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Project Chat View (Hidden by default) -->
            <div class="project-chat-view" id="projectChatView" style="display: none;">
                <!-- Project Header -->
                <header class="project-header">
                    <div class="project-nav">
                        <button class="back-btn" id="backToProjects">
                            <i class="fas fa-arrow-left"></i>
                            All projects
                        </button>
                    </div>
                    <div class="project-title-section">
                        <h1 class="project-title" id="currentProjectTitle">desktop design</h1>
                        <span class="project-subtitle" id="currentProjectSubtitle">instructions</span>
                    </div>
                    <div class="project-actions">
                        <button class="export-conversation-btn" id="exportConversation" title="Export Conversation">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="project-menu-btn">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                        <button class="project-star-btn">
                            <i class="far fa-star"></i>
                        </button>
                    </div>
                </header>

                <!-- Project Content -->
                <div class="project-content">
                    <!-- Chat Area -->
                    <div class="chat-area">
                        <div class="chat-messages" id="projectChatMessages">
                            <!-- Empty state -->
                            <div class="empty-chat-state">
                                <div class="welcome-message">
                                    <h2>How can I help you today?</h2>
                                </div>
                                <div class="project-actions-bar">
                                    <button class="action-button">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                    <button class="action-button">
                                        <i class="fas fa-random"></i>
                                    </button>
                                    <button class="action-button">
                                        <i class="fas fa-clock"></i>
                                    </button>
                                    <select class="model-selector">
                                        <option value="sonnet-4.5">Sonnet 4.5</option>
                                        <option value="gpt-4">GPT-4</option>
                                        <option value="claude-3">Echo Prime 3</option>
                                        <option value="copilot">GitHub Copilot</option>
                                    </select>
                                    <button class="send-button">
                                        <i class="fas fa-arrow-up"></i>
                                    </button>
                                </div>
                                <div class="chat-hint">
                                    Start a chat to keep conversations organized and re-use project knowledge.
                                </div>
                            </div>
                        </div>

                        <!-- Chat Input -->
                        <div class="chat-input-area">
                            <div class="input-container">
                                <button class="attachment-btn" id="attachmentBtn" title="Attach Files">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <input type="file" id="fileInput" multiple style="display: none;"
                                    accept=".txt,.pdf,.doc,.docx,.md,.json,.js,.py,.html,.css,.xml,.csv">
                                <button class="shuffle-btn" id="shuffleBtn" title="Shuffle AI Models">
                                    <i class="fas fa-random"></i>
                                </button>
                                <button class="clock-btn" id="clockBtn" title="Schedule Message">
                                    <i class="fas fa-clock"></i>
                                </button>
                                <button class="search-btn" id="searchBtn" title="Search Internet">
                                    <i class="fas fa-search"></i>
                                </button>

                                <!-- Multi-LLM Swarm Interface -->
                                <div class="llm-swarm-controls">
                                    <button class="fusion-mode-btn" id="fusionModeBtn" title="Echo Prime Fusion Mode">
                                        <i class="fas fa-brain"></i>
                                        <span>FUSION</span>
                                    </button>
                                    <div class="active-ais-panel" id="activeAIsPanel">
                                        <!-- Active AIs will appear here -->
                                    </div>
                                </div>

                                <input type="text" class="chat-input" placeholder="Reply to Echo Prime..." />
                                <div class="project-tag">
                                    <i class="fas fa-folder"></i>
                                    <span id="inputProjectName">desktop design</span>
                                </div>

                                <!-- Enhanced Model Selector with Summon Button -->
                                <div class="model-control-group">
                                    <button class="summon-btn" id="summonBtn" title="Summon/Dismiss AI">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                    <select class="input-model-selector" id="modelSelector">
                                        <!-- Echo Prime Models -->
                                        <optgroup label="ü§ñ Echo Prime">
                                            <option value="echo-prime-fusion">Echo Prime Fusion (All AIs)</option>
                                            <option value="echo-prime-3-opus">Echo Prime 3 Opus</option>
                                            <option value="echo-prime-sonnet">Echo Prime Sonnet 4.5</option>
                                        </optgroup>

                                        <!-- OpenAI Models -->
                                        <optgroup label="üß† OpenAI">
                                            <option value="gpt-4o">GPT-4o</option>
                                            <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                            <option value="gpt-4">GPT-4</option>
                                            <option value="gpt-4o-mini">GPT-4o Mini</option>
                                            <option value="o1-preview">O1 Preview</option>
                                            <option value="o1-mini">O1 Mini</option>
                                        </optgroup>

                                        <!-- Anthropic Models -->
                                        <optgroup label="üé≠ Anthropic">
                                            <option value="claude-3-opus">Claude 3 Opus</option>
                                            <option value="claude-3-sonnet">Claude 3 Sonnet</option>
                                            <option value="claude-3-haiku">Claude 3 Haiku</option>
                                            <option value="claude-3-5-sonnet">Claude 3.5 Sonnet</option>
                                        </optgroup>

                                        <!-- Google Models -->
                                        <optgroup label="üî∑ Google">
                                            <option value="gemini-1-5-pro">Gemini 1.5 Pro</option>
                                            <option value="gemini-1-5-flash">Gemini 1.5 Flash</option>
                                            <option value="gemini-pro">Gemini Pro</option>
                                        </optgroup>

                                        <!-- Meta Models -->
                                        <optgroup label="ü¶ô Meta">
                                            <option value="llama-3-1-405b">Llama 3.1 405B</option>
                                            <option value="llama-3-1-70b">Llama 3.1 70B</option>
                                            <option value="llama-3-1-8b">Llama 3.1 8B</option>
                                            <option value="llama-2-70b">Llama 2 70B</option>
                                        </optgroup>

                                        <!-- Mistral Models -->
                                        <optgroup label="üå™Ô∏è Mistral">
                                            <option value="mistral-large-2">Mistral Large 2</option>
                                            <option value="mistral-small">Mistral Small</option>
                                            <option value="codestral">Codestral</option>
                                        </optgroup>

                                        <!-- GitHub Models -->
                                        <optgroup label="üíª GitHub">
                                            <option value="github-copilot">GitHub Copilot</option>
                                            <option value="copilot-chat">Copilot Chat</option>
                                        </optgroup>

                                        <!-- Other Models -->
                                        <optgroup label="üöÄ Other">
                                            <option value="grok-beta">Grok Beta</option>
                                            <option value="cohere-command-r">Cohere Command R+</option>
                                            <option value="perplexity-sonar">Perplexity Sonar</option>
                                        </optgroup>
                                    </select>
                                </div>

                                <button class="submit-btn">
                                    <i class="fas fa-arrow-up"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Sidebar (Only visible in project chat view) -->
        <aside class="right-sidebar" id="rightSidebar" style="display: none;">
            <!-- Instructions Section -->
            <div class="sidebar-section">
                <div class="section-header">
                    <h3>Instructions</h3>
                    <button class="add-btn">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="section-content">
                    <div class="instructions-content" id="instructionsContent">
                        <p class="instructions-placeholder">Add instructions to tailor Claude's responses</p>
                        <div class="quick-instructions">
                            <button class="quick-instruction-btn" data-instruction="Code Review">üìù Code Review</button>
                            <button class="quick-instruction-btn" data-instruction="Creative Writing">‚ú® Creative
                                Writing</button>
                            <button class="quick-instruction-btn" data-instruction="Technical Documentation">üìö Tech
                                Docs</button>
                            <button class="quick-instruction-btn" data-instruction="Debugging">üêõ Debugging</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Files Section -->
            <div class="sidebar-section">
                <div class="section-header">
                    <h3>Files</h3>
                    <button class="add-btn">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="section-content">
                    <div class="files-placeholder">
                        <div class="file-icon">
                            <i class="fas fa-file"></i>
                        </div>
                        <div class="file-icon">
                            <i class="fas fa-image"></i>
                        </div>
                        <div class="file-icon">
                            <i class="fas fa-table"></i>
                        </div>
                        <p>Add PDFs, documents, or other text to reference in this project.</p>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Create Project Modal -->
    <div class="modal-overlay" id="createProjectModal">
        <div class="modal">
            <div class="modal-content">
                <h2>Create a personal project</h2>

                <div class="form-group">
                    <label>What are you working on?</label>
                    <input type="text" id="projectName" placeholder="Name your project" />
                </div>

                <div class="form-group">
                    <label>What are you trying to achieve?</label>
                    <textarea id="projectDescription"
                        placeholder="Describe your project, goals, subject, etc..."></textarea>
                </div>

                <div class="modal-actions">
                    <button class="cancel-btn" id="cancelProject">Cancel</button>
                    <button class="create-btn" id="confirmCreateProject">Create project</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Set Project Instructions Modal -->
    <div class="modal-overlay" id="instructionsModal">
        <div class="modal">
            <div class="modal-content instructions-modal">
                <div class="modal-header">
                    <h2>Set project instructions</h2>
                    <button class="close-btn" id="closeInstructions">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="instructions-content">
                    <div class="instructions-left">
                        <p>Provide Claude with relevant instructions and <a href="#" class="link">context</a> specific
                            to this project.</p>
                        <p>You can reference <a href="#" class="link">user preferences</a> and files selected from the
                            right sidebar to tailor Claude's responses.</p>

                        <div class="form-group">
                            <textarea id="projectInstructions"
                                placeholder="When giving feedback, explain thought process and highlight issues and opportunities."
                                rows="10"></textarea>
                        </div>
                    </div>

                    <div class="instructions-right">
                        <h3>Add files to project</h3>
                        <div class="file-upload-area">
                            <div class="upload-zone" id="fileUploadZone">
                                <p>Drag files here or <button class="browse-btn" id="browseFiles">browse</button></p>
                                <input type="file" id="fileInput" multiple style="display: none;" />
                            </div>
                        </div>

                        <div class="modal-actions">
                            <button class="cancel-btn" id="cancelInstructions">Cancel</button>
                            <button class="add-btn" id="addInstructions">Add files</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Projects Modal -->
    <div class="modal-overlay" id="importProjectsModal">
        <div class="modal">
            <div class="modal-content import-modal">
                <div class="modal-header">
                    <h2>Import Claude Projects & Conversations</h2>
                    <button class="close-btn" id="closeImport">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="import-content">
                    <div class="import-instructions">
                        <p>Import your existing Claude Desktop projects and conversations to continue your work
                            seamlessly.</p>

                        <div class="import-options">
                            <div class="import-option">
                                <h4><i class="fas fa-file-upload"></i> Upload Export File</h4>
                                <p>Select a Claude export file (.json or .txt)</p>
                                <div class="file-upload-area">
                                    <div class="upload-zone" id="importFileUploadZone">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Drag your Claude export file here or <button class="browse-btn"
                                                id="browseImportFile">browse</button></p>
                                        <input type="file" id="importFileInput" accept=".json,.txt,.md"
                                            style="display: none;" />
                                    </div>
                                </div>
                            </div>

                            <div class="import-option">
                                <h4><i class="fas fa-paste"></i> Paste Conversation Data</h4>
                                <p>Paste exported conversation text directly</p>
                                <textarea id="importTextArea" placeholder="Paste your Claude conversation export here...
                                    
Example formats supported:
- Claude Desktop export JSON
- Raw conversation text
- Markdown conversation format" rows="8"></textarea>
                            </div>
                        </div>

                        <div class="import-preview" id="importPreview" style="display: none;">
                            <h4>Import Preview</h4>
                            <div class="preview-content" id="previewContent"></div>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button class="cancel-btn" id="cancelImport">Cancel</button>
                        <button class="import-btn" id="confirmImport" disabled>
                            <i class="fas fa-file-import"></i>
                            Import Projects
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ECHO PRIME - Multi-LLM Swarm Integration
        let currentProject = null;
        let messageHistory = [];
        let activeAIs = new Set(); // Track active AIs
        let fusionMode = false; // Fusion mode state

        // Initialize the interface
        document.addEventListener('DOMContentLoaded', function () {
            setupEventListeners();
            checkServerConnection();
            initializeMultiLLMInterface();
        });

        function setupEventListeners() {
            console.log('üîß Setting up ALL event listeners...');

            // Chat input handling
            const chatInput = document.querySelector('.chat-input');
            const submitButton = document.querySelector('.submit-btn');

            if (chatInput && submitButton) {
                chatInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });

                submitButton.addEventListener('click', sendMessage);
                console.log('‚úÖ Chat input and submit button listeners added');
            }

            // File attachment functionality
            const attachmentBtn = document.getElementById('attachmentBtn');
            const fileInput = document.getElementById('fileInput');

            if (attachmentBtn && fileInput) {
                attachmentBtn.addEventListener('click', function () {
                    fileInput.click();
                });

                fileInput.addEventListener('change', function (e) {
                    handleFileUpload(e.target.files);
                });
                console.log('‚úÖ File attachment listeners added');
            }

            // Drag and drop for file upload
            const chatInputArea = document.querySelector('.chat-input-area');
            if (chatInputArea) {
                chatInputArea.addEventListener('dragover', function (e) {
                    e.preventDefault();
                    chatInputArea.classList.add('drag-over');
                });

                chatInputArea.addEventListener('dragleave', function (e) {
                    e.preventDefault();
                    chatInputArea.classList.remove('drag-over');
                });

                chatInputArea.addEventListener('drop', function (e) {
                    e.preventDefault();
                    chatInputArea.classList.remove('drag-over');
                    if (e.dataTransfer.files.length > 0) {
                        handleFileUpload(e.dataTransfer.files);
                    }
                });
                console.log('‚úÖ Drag and drop listeners added');
            }

            // Shuffle button functionality
            const shuffleBtn = document.getElementById('shuffleBtn');
            if (shuffleBtn) {
                shuffleBtn.addEventListener('click', function () {
                    shuffleAIModel();
                });
                console.log('‚úÖ Shuffle button listener added');
            }

            // Clock/Schedule button functionality
            const clockBtn = document.getElementById('clockBtn');
            if (clockBtn) {
                clockBtn.addEventListener('click', function () {
                    showScheduleDialog();
                });
                console.log('‚úÖ Clock button listener added');
            }

            // Search button
            const searchBtn = document.getElementById('searchBtn');
            if (searchBtn) {
                searchBtn.addEventListener('click', function () {
                    const chatInput = document.querySelector('.chat-input');
                    if (chatInput && chatInput.value.trim()) {
                        performInternetSearch(chatInput.value.trim());
                    } else {
                        alert('Please enter a search query first');
                    }
                });
                console.log('‚úÖ Search button listener added');
            }

            // Back to projects button
            const backBtn = document.getElementById('backToProjects');
            if (backBtn) {
                backBtn.addEventListener('click', function () {
                    closeProject();
                });
                console.log('‚úÖ Back button listener added');
            }

            // Create project button
            const createProjectBtn = document.getElementById('createProjectBtn');
            if (createProjectBtn) {
                createProjectBtn.addEventListener('click', function () {
                    showCreateProjectDialog();
                });
                console.log('‚úÖ Create project button listener added');
            }

            // Import projects button
            const importProjectsBtn = document.getElementById('importProjectsBtn');
            if (importProjectsBtn) {
                importProjectsBtn.addEventListener('click', function () {
                    showImportProjectsDialog();
                });
                console.log('‚úÖ Import projects button listener added');
            }

            // Export conversation button
            const exportBtn = document.getElementById('exportConversation');
            if (exportBtn) {
                exportBtn.addEventListener('click', function () {
                    exportConversation();
                });
                console.log('‚úÖ Export conversation button listener added');
            }

            // New chat button
            const newChatBtn = document.querySelector('.new-chat-button');
            if (newChatBtn) {
                newChatBtn.addEventListener('click', function () {
                    startNewChat();
                });
                console.log('‚úÖ New chat button listener added');
            }

            // Profile menu button
            const profileBtn = document.querySelector('.profile-menu-btn');
            if (profileBtn) {
                profileBtn.addEventListener('click', function () {
                    showProfileMenu();
                });
                console.log('‚úÖ Profile button listener added');
            }

            // Project menu buttons
            document.querySelectorAll('.project-menu, .project-menu-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    showProjectMenu(this);
                });
            });
            console.log('‚úÖ Project menu button listeners added');

            // Project star buttons
            document.querySelectorAll('.project-star, .project-star-btn').forEach(btn => {
                btn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    toggleProjectStar(this);
                });
            });
            console.log('‚úÖ Project star button listeners added');

            // Model selector
            const modelSelector = document.getElementById('modelSelector');
            if (modelSelector) {
                modelSelector.addEventListener('change', function () {
                    console.log('Model changed to:', this.value);
                    updateModelSelection(this.value);
                });
                console.log('‚úÖ Model selector listener added');
            }

            // Project items
            document.querySelectorAll('.project-item').forEach(item => {
                item.addEventListener('click', function () {
                    const projectName = this.querySelector('.project-name').textContent;
                    openProject(projectName);
                });
            });
            console.log('‚úÖ Project item listeners added');

            // Quick instruction buttons
            document.querySelectorAll('.quick-instruction-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    addQuickInstruction(this.dataset.instruction);
                });
            });
            console.log('‚úÖ Quick instruction button listeners added');

            console.log('üéâ ALL event listeners successfully set up!');
        }

        async function checkServerConnection() {
            try {
                const response = await fetch('/api/status');
                if (response.ok) {
                    console.log('‚úÖ Server connection established');
                } else {
                    console.warn('‚ö†Ô∏è Server connection issue');
                }
            } catch (error) {
                console.error('‚ùå Server not reachable:', error);
                showConnectionError();
            }
        }

        function showConnectionError() {
            const chatMessages = document.getElementById('projectChatMessages');
            if (chatMessages) {
                chatMessages.innerHTML = `
                    <div class="message system-message">
                        <div class="message-content">
                            <p>‚ö†Ô∏è Unable to connect to AI server. Please ensure the server is running on port 3001.</p>
                            <p>Run: <code>node server.js</code> to start the server.</p>
                        </div>
                    </div>
                `;
            }
        }

        async function performInternetSearch(query) {
            console.log('üîç Performing internet search for:', query);

            // Add search message to chat
            addMessageToChat('user', `üîç Search: ${query}`, null, 'You', 'search-message');

            // Show typing indicator
            const typingId = addTypingIndicator('Internet Search');

            try {
                const response = await fetch('/api/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        query: query,
                        maxResults: 5
                    })
                });

                const data = await response.json();
                removeTypingIndicator(typingId);

                if (data.success && data.results.length > 0) {
                    // Format search results
                    let searchResultsHtml = `<div class="search-results">
                        <h4>üåê Internet Search Results for "${query}":</h4>
                        <div class="results-list">`;

                    data.results.forEach((result, index) => {
                        searchResultsHtml += `
                            <div class="search-result">
                                <h5><a href="${result.url}" target="_blank">${result.title}</a></h5>
                                <p>${result.snippet}</p>
                                <small>Source: ${result.source}</small>
                            </div>`;
                    });

                    searchResultsHtml += `</div></div>`;

                    addMessageToChat('assistant', searchResultsHtml, 'internet-search', 'Internet Search', 'search-results');
                } else {
                    addMessageToChat('assistant', '‚ùå No search results found. Please try a different query.', 'internet-search', 'Internet Search');
                }
            } catch (error) {
                console.error('Search error:', error);
                removeTypingIndicator(typingId);
                addMessageToChat('assistant', '‚ùå Search failed. Please try again.', 'internet-search', 'Internet Search');
            }
        }

        async function sendMessage() {
            const chatInput = document.querySelector('.chat-input');
            const message = chatInput.value.trim();

            if (!message) return;

            // Clear input
            chatInput.value = '';

            // Add user message to chat
            addMessageToChat('user', message);

            if (fusionMode) {
                // Fusion Mode: Get responses from all AIs and merge them
                await handleFusionResponse(message);
            } else if (activeAIs.size > 1) {
                // Multi-AI Mode: Let active AIs collaborate
                await handleMultiAIResponse(message);
            } else if (activeAIs.size === 1) {
                // Single AI Mode: Send to active AI
                const aiModel = Array.from(activeAIs)[0];
                await handleSingleAIResponse(message, aiModel);
            } else {
                // Default Mode: Use selected model
                const modelSelector = document.getElementById('modelSelector');
                const selectedModel = modelSelector ? modelSelector.value : 'claude-3-opus';
                await handleSingleAIResponse(message, selectedModel);
            }
        }

        async function handleFusionResponse(message) {
            const typingId = addTypingIndicator('Echo Prime Fusion Brain');

            try {
                // Get responses from multiple AIs simultaneously
                const aiModels = ['claude-3-opus', 'gpt-4o', 'gemini-1-5-pro', 'llama-3-1-405b'];
                const responses = await Promise.allSettled(
                    aiModels.map(model => getAIResponse(message, model))
                );

                // Process and merge responses
                const validResponses = responses
                    .filter(result => result.status === 'fulfilled' && result.value)
                    .map(result => result.value);

                if (validResponses.length > 0) {
                    removeTypingIndicator(typingId);

                    // Create fusion response
                    const fusionResponse = createFusionResponse(validResponses, message);
                    addMessageToChat('assistant', fusionResponse, 'echo-prime-fusion', 'Echo Prime Fusion', 'fusion-message');

                    // Add to history
                    messageHistory.push(
                        { role: 'user', content: message },
                        { role: 'assistant', content: fusionResponse, service: 'echo-prime-fusion' }
                    );
                } else {
                    removeTypingIndicator(typingId);
                    addMessageToChat('system', 'Fusion mode temporarily unavailable. Please try again.');
                }

            } catch (error) {
                removeTypingIndicator(typingId);
                addMessageToChat('system', `Fusion error: ${error.message}`);
                console.error('Fusion mode error:', error);
            }
        }

        async function handleMultiAIResponse(message) {
            const aiArray = Array.from(activeAIs);

            // Add collaboration context
            const collaborationContext = `You are collaborating with other AIs: ${aiArray.map(getAIName).join(', ')}. Feel free to reference their potential perspectives or build upon their likely responses.`;

            // Send to each active AI
            for (const aiModel of aiArray) {
                const typingId = addTypingIndicator(getAIName(aiModel));

                try {
                    const response = await getAIResponse(message + '\n\n' + collaborationContext, aiModel);

                    if (response) {
                        removeTypingIndicator(typingId);
                        addMessageToChat('assistant', response.response, aiModel, getAIName(aiModel), 'multi-ai-message');

                        messageHistory.push(
                            { role: 'assistant', content: response.response, service: aiModel }
                        );
                    } else {
                        removeTypingIndicator(typingId);
                        addMessageToChat('system', `${getAIName(aiModel)} is temporarily unavailable.`);
                    }

                } catch (error) {
                    removeTypingIndicator(typingId);
                    addMessageToChat('system', `${getAIName(aiModel)} error: ${error.message}`);
                }
            }

            // Add user message to history once
            messageHistory.push({ role: 'user', content: message });
        }

        async function handleSingleAIResponse(message, model) {
            const typingId = addTypingIndicator(getAIName(model));

            try {
                const response = await getAIResponse(message, model);

                if (response) {
                    removeTypingIndicator(typingId);
                    addMessageToChat('assistant', response.response, model, getAIName(model));

                    messageHistory.push(
                        { role: 'user', content: message },
                        { role: 'assistant', content: response.response, service: model }
                    );
                } else {
                    removeTypingIndicator(typingId);
                    addMessageToChat('system', `${getAIName(model)} is temporarily unavailable.`);
                }

            } catch (error) {
                removeTypingIndicator(typingId);
                addMessageToChat('system', `${getAIName(model)} error: ${error.message}`);
            }
        }

        async function getAIResponse(message, model) {
            const service = getServiceFromModel(model);

            console.log('üîç Sending request:', { message, service, model, project: currentProject });

            const response = await fetch('/api/ai/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: message,
                    service: service,
                    model: model,
                    project: currentProject,
                    context: messageHistory.slice(-5)
                })
            });

            if (response.ok) {
                const data = await response.json();
                console.log('‚úÖ AI Response received:', data);
                return data;
            } else {
                console.error('‚ùå AI Response error:', response.status, response.statusText);
                return null;
            }
        }

        function createFusionResponse(responses, originalMessage) {
            const intro = 'üß† **ECHO PRIME FUSION RESPONSE** üß†\n\n';
            const summary = 'After consulting the collective swarm intelligence, here is the unified response:\n\n';

            // Merge insights from different AIs
            let mergedResponse = summary;

            // Extract key insights and combine them intelligently
            const insights = responses.map((res, index) => {
                const aiName = ['Claude', 'GPT-4', 'Gemini', 'Llama'][index] || `AI-${index}`;
                return `**${aiName}**: ${res.response}`;
            });

            mergedResponse += insights.join('\n\n---\n\n');

            mergedResponse += '\n\n**üîÆ Fusion Synthesis:**\nThe Echo Prime collective has analyzed this from multiple perspectives to provide you with the most comprehensive response possible.';

            return intro + mergedResponse;
        }

        function getServiceFromModel(model) {
            if (model.includes('claude')) return 'claude';
            if (model.includes('gpt')) return 'openai';
            if (model.includes('copilot')) return 'copilot';
            if (model.includes('llama')) return 'ollama';
            return 'claude'; // default
        }

        function addMessageToChat(role, content, service = null, model = null, messageClass = '') {
            const chatMessages = document.getElementById('projectChatMessages');
            const emptyState = chatMessages.querySelector('.empty-chat-state');

            // Remove empty state if present
            if (emptyState) {
                emptyState.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}-message ${messageClass}`;

            let avatar = '';
            let name = '';

            switch (role) {
                case 'user':
                    avatar = 'üë§';
                    name = 'You';
                    break;
                case 'assistant':
                    // Enhanced AI avatars and names
                    if (service === 'echo-prime-fusion') {
                        avatar = 'üß†';
                        name = 'Echo Prime Fusion';
                    } else {
                        avatar = getAIEmoji(service) || (service === 'claude' ? 'ü§ñ' :
                            service === 'openai' ? 'üß†' :
                                service === 'copilot' ? 'üíª' : 'ü§ñ');
                        name = model || getAIName(service) || (service ? service.charAt(0).toUpperCase() + service.slice(1) : 'AI');
                    }
                    break;
                case 'system':
                    avatar = '‚ö†Ô∏è';
                    name = 'System';
                    break;
            }

            messageDiv.innerHTML = `
                <div class="message-header">
                    <span class="message-avatar">${avatar}</span>
                    <span class="message-name">${name}</span>
                    <span class="message-time">${new Date().toLocaleTimeString()}</span>
                </div>
                <div class="message-content">
                    ${typeof content === 'string' && content.includes('<div') ? content : `<p>${content.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p>`}
                </div>
            `;

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addTypingIndicator(aiName = 'Echo Prime') {
            const chatMessages = document.getElementById('projectChatMessages');
            const typingDiv = document.createElement('div');
            const typingId = 'typing-' + Date.now();
            typingDiv.id = typingId;
            typingDiv.className = 'message assistant-message typing';

            typingDiv.innerHTML = `
                <div class="message-header">
                    <span class="message-avatar">ü§ñ</span>
                    <span class="message-name">${aiName}</span>
                </div>
                <div class="message-content">
                    <p>Thinking...</p>
                </div>
            `;

            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return typingId;
        }

        function removeTypingIndicator(typingId) {
            const typingDiv = document.getElementById(typingId);
            if (typingDiv) {
                typingDiv.remove();
            }
        }

        function closeProject() {
            // Hide project chat view and show projects list
            document.getElementById('projectChatView').style.display = 'none';
            document.getElementById('projectsView').style.display = 'block';

            // Clear current project
            currentProject = null;
            messageHistory = [];

            console.log('Closed project view');
        }

        function openProject(projectName) {
            currentProject = projectName;

            // Show project chat view
            document.getElementById('projectsView').style.display = 'none';
            document.getElementById('projectChatView').style.display = 'flex';

            // Update project title
            const projectTitle = document.querySelector('.project-title');
            if (projectTitle) {
                projectTitle.textContent = projectName;
            }

            // Clear previous chat
            const chatMessages = document.getElementById('projectChatMessages');
            chatMessages.innerHTML = `
                <div class="message assistant-message">
                    <div class="message-header">
                        <span class="message-avatar">ü§ñ</span>
                        <span class="message-name">Echo Prime</span>
                        <span class="message-time">${new Date().toLocaleTimeString()}</span>
                    </div>
                    <div class="message-content">
                        <p>Welcome to the ${projectName} project! I'm Echo Prime, ready to assist you with development, analysis, and any questions you have. How can I assist you today?</p>
                    </div>
                </div>
            `;

            messageHistory = [];
            console.log('Opened project:', projectName);
        }

        // Add some CSS for messages
        const messageStyles = `
            <style>
            .message {
                margin-bottom: 16px;
                padding: 12px;
                border-radius: 8px;
                background: rgba(255, 255, 255, 0.05);
            }
            
            .message-header {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-bottom: 8px;
                font-size: 14px;
                opacity: 0.8;
            }
            
            .message-avatar {
                font-size: 16px;
            }
            
            .message-name {
                font-weight: 600;
            }
            
            .message-time {
                margin-left: auto;
                font-size: 12px;
                opacity: 0.6;
            }
            
            .message-content p {
                margin: 0;
                line-height: 1.5;
            }
            
            .user-message {
                background: rgba(0, 123, 255, 0.1);
            }
            
            .assistant-message {
                background: rgba(0, 255, 127, 0.1);
            }
            
            .system-message {
                background: rgba(255, 193, 7, 0.1);
            }
            
            .typing {
                opacity: 0.7;
                animation: pulse 1.5s infinite;
            }
            
            @keyframes pulse {
                0%, 100% { opacity: 0.7; }
                50% { opacity: 1; }
            }
            
            /* Multi-LLM Swarm Interface Styles */
            .llm-swarm-controls {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-bottom: 8px;
            }
            
            .fusion-mode-btn {
                background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
                background-size: 400% 400%;
                animation: fusionGradient 3s ease infinite;
                border: none;
                border-radius: 8px;
                padding: 8px 12px;
                color: white;
                font-weight: bold;
                font-size: 12px;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 4px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                transition: all 0.3s ease;
            }
            
            .fusion-mode-btn:hover {
                transform: scale(1.05);
                box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            }
            
            .fusion-mode-btn.active {
                animation: fusionPulse 1s ease infinite;
                box-shadow: 0 0 20px rgba(255, 107, 107, 0.6);
            }
            
            @keyframes fusionGradient {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            
            @keyframes fusionPulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.1); }
            }
            
            .active-ais-panel {
                display: flex;
                gap: 4px;
                flex-wrap: wrap;
                max-width: 200px;
            }
            
            .active-ai-chip {
                background: rgba(0, 255, 127, 0.1);
                border: 1px solid rgba(0, 255, 127, 0.3);
                border-radius: 12px;
                padding: 4px 8px;
                font-size: 11px;
                color: #00ff7f;
                display: flex;
                align-items: center;
                gap: 4px;
                cursor: pointer;
                transition: all 0.2s ease;
            }
            
            .active-ai-chip:hover {
                background: rgba(0, 255, 127, 0.2);
                transform: scale(1.05);
            }
            
            .active-ai-chip .dismiss-btn {
                font-size: 10px;
                opacity: 0.7;
                margin-left: 2px;
            }
            
            .model-control-group {
                display: flex;
                align-items: center;
                gap: 4px;
            }
            
            .summon-btn {
                background: rgba(0, 123, 255, 0.1);
                border: 1px solid rgba(0, 123, 255, 0.3);
                border-radius: 6px;
                padding: 8px 10px;
                color: #007bff;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 14px;
            }
            
            .summon-btn:hover {
                background: rgba(0, 123, 255, 0.2);
                transform: scale(1.05);
            }
            
            .summon-btn.dismiss {
                background: rgba(255, 0, 0, 0.1);
                border-color: rgba(255, 0, 0, 0.3);
                color: #ff4444;
            }
            
            .summon-btn.dismiss:hover {
                background: rgba(255, 0, 0, 0.2);
            }
            
            .input-model-selector {
                min-width: 180px;
                max-width: 220px;
            }
            
            /* Multi-AI Message Styles */
            .multi-ai-message {
                border-left: 4px solid #4ecdc4;
                margin-left: 8px;
            }
            
            .fusion-message {
                background: linear-gradient(45deg, 
                    rgba(255, 107, 107, 0.1), 
                    rgba(78, 205, 196, 0.1), 
                    rgba(69, 183, 209, 0.1));
                border-left: 4px solid #ff6b6b;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
            
            .ai-collaboration-header {
                font-size: 12px;
                opacity: 0.8;
                margin-bottom: 4px;
                color: #4ecdc4;
            }
            </style>
        `;

        document.head.insertAdjacentHTML('beforeend', messageStyles);

        // Multi-LLM Swarm Intelligence Functions
        function initializeMultiLLMInterface() {
            const summonBtn = document.getElementById('summonBtn');
            const fusionBtn = document.getElementById('fusionModeBtn');
            const modelSelector = document.getElementById('modelSelector');

            // Summon/Dismiss AI functionality
            summonBtn.addEventListener('click', function () {
                const selectedModel = modelSelector.value;
                if (activeAIs.has(selectedModel)) {
                    dismissAI(selectedModel);
                } else {
                    summonAI(selectedModel);
                }
                updateSummonButton();
            });

            // Fusion mode toggle
            fusionBtn.addEventListener('click', function () {
                toggleFusionMode();
            });

            // Model selector change
            modelSelector.addEventListener('change', function () {
                updateSummonButton();
            });

            updateSummonButton();
        }

        function summonAI(model) {
            if (model === 'echo-prime-fusion') {
                toggleFusionMode();
                return;
            }

            activeAIs.add(model);
            updateActiveAIsPanel();

            const chatMessages = document.getElementById('projectChatMessages');
            addMessageToChat('system', `üöÄ ${getAIName(model)} has joined the conversation. ${activeAIs.size > 1 ? 'Multiple AIs are now active and can collaborate.' : ''}`);

            console.log(`‚ú® Summoned: ${getAIName(model)}`);
        }

        function dismissAI(model) {
            activeAIs.delete(model);
            updateActiveAIsPanel();

            addMessageToChat('system', `üëã ${getAIName(model)} has left the conversation.`);
            console.log(`üåô Dismissed: ${getAIName(model)}`);
        }

        function toggleFusionMode() {
            fusionMode = !fusionMode;
            const fusionBtn = document.getElementById('fusionModeBtn');

            if (fusionMode) {
                // Activate fusion mode - summon all available AIs
                const allModels = [
                    'gpt-4o', 'claude-3-opus', 'gemini-1-5-pro', 'llama-3-1-405b',
                    'mistral-large-2', 'github-copilot', 'grok-beta'
                ];

                allModels.forEach(model => activeAIs.add(model));
                fusionBtn.classList.add('active');

                addMessageToChat('system', `üß† ECHO PRIME FUSION MODE ACTIVATED üß†\n\nAll AIs have been summoned into the swarm brain. Your queries will be processed by the collective intelligence for maximum insight and capability.`, null, null, 'fusion-message');

                console.log('üß† FUSION MODE ACTIVATED - Echo Prime Swarm Brain Online');
            } else {
                // Deactivate fusion mode
                activeAIs.clear();
                fusionBtn.classList.remove('active');

                addMessageToChat('system', `üåü Echo Prime Fusion Mode Deactivated. Individual AI selection restored.`);
                console.log('üåü Fusion Mode Deactivated');
            }

            updateActiveAIsPanel();
            updateSummonButton();
        }

        function updateActiveAIsPanel() {
            const panel = document.getElementById('activeAIsPanel');
            panel.innerHTML = '';

            activeAIs.forEach(model => {
                const chip = document.createElement('div');
                chip.className = 'active-ai-chip';
                chip.innerHTML = `
                    <span>${getAIEmoji(model)}</span>
                    <span>${getAIShortName(model)}</span>
                    <span class="dismiss-btn" onclick="dismissAI('${model}')">√ó</span>
                `;
                panel.appendChild(chip);
            });
        }

        function updateSummonButton() {
            const summonBtn = document.getElementById('summonBtn');
            const selectedModel = document.getElementById('modelSelector').value;

            if (activeAIs.has(selectedModel) || (fusionMode && selectedModel !== 'echo-prime-fusion')) {
                summonBtn.innerHTML = '<i class="fas fa-minus"></i>';
                summonBtn.classList.add('dismiss');
                summonBtn.title = 'Dismiss AI';
            } else {
                summonBtn.innerHTML = '<i class="fas fa-plus"></i>';
                summonBtn.classList.remove('dismiss');
                summonBtn.title = 'Summon AI';
            }
        }

        function getAIName(model) {
            const names = {
                'gpt-4o': 'GPT-4o',
                'gpt-4-turbo': 'GPT-4 Turbo',
                'gpt-4': 'GPT-4',
                'claude-3-opus': 'Claude 3 Opus',
                'claude-3-sonnet': 'Claude 3 Sonnet',
                'claude-3-5-sonnet': 'Claude 3.5 Sonnet',
                'gemini-1-5-pro': 'Gemini 1.5 Pro',
                'llama-3-1-405b': 'Llama 3.1 405B',
                'mistral-large-2': 'Mistral Large 2',
                'github-copilot': 'GitHub Copilot',
                'grok-beta': 'Grok Beta'
            };
            return names[model] || model;
        }

        function getAIShortName(model) {
            const shortNames = {
                'gpt-4o': 'GPT-4o',
                'claude-3-opus': 'Claude',
                'gemini-1-5-pro': 'Gemini',
                'llama-3-1-405b': 'Llama',
                'mistral-large-2': 'Mistral',
                'github-copilot': 'Copilot',
                'grok-beta': 'Grok'
            };
            return shortNames[model] || model.split('-')[0];
        }

        function getAIEmoji(model) {
            const emojis = {
                'gpt-4o': 'üß†',
                'claude-3-opus': 'üé≠',
                'gemini-1-5-pro': 'üî∑',
                'llama-3-1-405b': 'ü¶ô',
                'mistral-large-2': 'üå™Ô∏è',
                'github-copilot': 'üíª',
                'grok-beta': 'üöÄ'
            };
            return emojis[model] || 'ü§ñ';
        }

        // ===== COMPREHENSIVE BUTTON FUNCTIONALITY IMPLEMENTATION =====

        // File Upload Functions
        function handleFileUpload(files) {
            console.log('üìÅ Handling file upload:', files.length, 'files');

            if (files.length === 0) return;

            const fileList = Array.from(files);
            let fileInfoHtml = '<div class="uploaded-files"><h4>üìé Attached Files:</h4><ul>';

            fileList.forEach((file, index) => {
                fileInfoHtml += `<li>${file.name} (${formatFileSize(file.size)})</li>`;

                // Read file content if it's text-based
                if (isTextFile(file)) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const content = e.target.result;
                        addMessageToChat('system', `üìÅ File Content: ${file.name}\n\n${content.substring(0, 1000)}${content.length > 1000 ? '...' : ''}`, 'file-upload', 'File Upload');
                    };
                    reader.readAsText(file);
                }
            });

            fileInfoHtml += '</ul></div>';
            addMessageToChat('user', fileInfoHtml, 'file-upload', 'You');

            // Clear the file input
            const fileInput = document.getElementById('fileInput');
            if (fileInput) fileInput.value = '';
        }

        function formatFileSize(bytes) {
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            if (bytes === 0) return '0 Bytes';
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
        }

        function isTextFile(file) {
            const textTypes = ['text/', 'application/json', 'application/javascript', 'application/xml'];
            return textTypes.some(type => file.type.startsWith(type)) ||
                ['.txt', '.md', '.js', '.py', '.html', '.css', '.json', '.xml', '.csv'].some(ext => file.name.endsWith(ext));
        }

        // Shuffle AI Model Function
        function shuffleAIModel() {
            const modelSelector = document.getElementById('modelSelector');
            if (!modelSelector) return;

            const options = Array.from(modelSelector.options).filter(opt => !opt.disabled);
            const randomIndex = Math.floor(Math.random() * options.length);
            const randomModel = options[randomIndex].value;

            modelSelector.value = randomModel;
            addMessageToChat('system', `üé≤ Shuffled to AI model: ${options[randomIndex].text}`, 'shuffle', 'System');
            updateModelSelection(randomModel);
        }

        // Schedule Message Function
        function showScheduleDialog() {
            const currentTime = new Date();
            const timeString = currentTime.toTimeString().substring(0, 5);

            const message = prompt(`‚è∞ Schedule Message\n\nCurrent time: ${timeString}\nEnter time to send (HH:MM format):`, timeString);

            if (message) {
                addMessageToChat('system', `‚è∞ Message scheduled for ${message}. (Note: This is a demo - actual scheduling would require backend implementation)`, 'schedule', 'Scheduler');
            }
        }

        // Project Management Functions
        function showCreateProjectDialog() {
            const modal = document.getElementById('createProjectModal');
            if (modal) {
                modal.style.display = 'block';
                modal.classList.add('modal-show');
            } else {
                // Fallback if modal doesn't exist
                const projectName = prompt('Create New Project\n\nEnter project name:');
                if (projectName && projectName.trim()) {
                    createNewProject(projectName.trim());
                }
            }
        }

        function showImportProjectsDialog() {
            const modal = document.getElementById('importProjectsModal');
            if (modal) {
                modal.style.display = 'block';
                modal.classList.add('modal-show');
            } else {
                // Fallback if modal doesn't exist
                const conversation = prompt('Import Conversation\n\nPaste your conversation export here:');
                if (conversation && conversation.trim()) {
                    importConversation(conversation.trim());
                }
            }
        }

        function createNewProject(name) {
            console.log('Creating new project:', name);
            addMessageToChat('system', `‚úÖ Created new project: "${name}"`, 'project', 'Project Manager');
            // Add actual project creation logic here
        }

        function importConversation(data) {
            console.log('Importing conversation data:', data.length, 'characters');
            addMessageToChat('system', `üì• Imported conversation data (${data.length} characters)`, 'import', 'Import Manager');
            // Add actual import logic here
        }

        // Export Functions
        function exportConversation() {
            const messages = document.querySelectorAll('.message');
            let exportData = `Echo Prime Conversation Export - ${new Date().toISOString()}\n\n`;

            messages.forEach(msg => {
                const name = msg.querySelector('.message-name')?.textContent || 'Unknown';
                const time = msg.querySelector('.message-time')?.textContent || '';
                const content = msg.querySelector('.message-content')?.textContent || '';
                exportData += `[${time}] ${name}: ${content}\n\n`;
            });

            // Create download
            const blob = new Blob([exportData], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `echo-prime-chat-${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);

            addMessageToChat('system', 'üì§ Conversation exported successfully!', 'export', 'Export Manager');
        }

        // New Chat Function
        function startNewChat() {
            if (confirm('Start a new chat? This will clear the current conversation.')) {
                const chatMessages = document.getElementById('projectChatMessages');
                if (chatMessages) {
                    chatMessages.innerHTML = `
                        <div class="message assistant-message">
                            <div class="message-header">
                                <span class="message-avatar">ü§ñ</span>
                                <span class="message-name">Echo Prime</span>
                                <span class="message-time">${new Date().toLocaleTimeString()}</span>
                            </div>
                            <div class="message-content">
                                <p>New chat started! How can I assist you today?</p>
                            </div>
                        </div>
                    `;
                }
                messageHistory = [];
                console.log('ÔøΩ New chat started');
            }
        }

        // Profile Menu Function
        function showProfileMenu() {
            addMessageToChat('system', 'üë§ Profile menu functionality would open here. This would show user settings, preferences, and account options.', 'profile', 'Profile Manager');
        }

        // Project Menu Functions
        function showProjectMenu(element) {
            addMessageToChat('system', 'üìã Project menu functionality would open here. Options would include: Edit, Delete, Duplicate, Share, Archive.', 'project-menu', 'Project Manager');
        }

        function toggleProjectStar(element) {
            const icon = element.querySelector('i');
            if (icon) {
                const isStarred = icon.classList.contains('fas');
                if (isStarred) {
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                    addMessageToChat('system', '‚≠ê Project removed from favorites', 'star', 'Project Manager');
                } else {
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    addMessageToChat('system', '‚≠ê Project added to favorites', 'star', 'Project Manager');
                }
            }
        }

        // Model Selection Function
        function updateModelSelection(model) {
            console.log('ü§ñ Model updated to:', model);
            addMessageToChat('system', `ü§ñ AI model switched to: ${model}`, 'model-change', 'Model Manager');
        }

        // Quick Instructions Function
        function addQuickInstruction(instruction) {
            const chatInput = document.querySelector('.chat-input');
            if (chatInput) {
                chatInput.value = instruction + ' ';
                chatInput.focus();
            }
            addMessageToChat('system', `üìù Quick instruction added: "${instruction}"`, 'instruction', 'Instruction Manager');
        }

        console.log('ÔøΩüåü ECHO PRIME Interface Ready - Real AI Integration Active');
        console.log('üéâ ALL BUTTON FUNCTIONALITY IMPLEMENTED!');
    </script>

    <script src="js/claude-projects.js"></script>
    <script src="js/integration-test.js"></script>
    <script src="js/performance-optimizer.js"></script>
    <script src="security-hardening.js"></script>
    <script src="test-suite.js"></script>
</body>

</html>